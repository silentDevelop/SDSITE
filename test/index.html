
<html>
	
	<body>

		<h1>My First Google Map</h1>

		<div align="center" id="googleMap" style="width:80%;height:80%;" ></div>


		<input type="file" id="file-selector" accept=".gpx">
		<p id="temp"></p>
		<script>

			var map;


		const fileSelector = document.getElementById('file-selector');
		fileSelector.addEventListener('change', (event) => {
			const file = event.target.files[0];
			const size = file.size ? file.size : 'NOT SUPPORTED';
			if(size < 5131260){
				var fr = new FileReader();

           	 	fr.onload=function(){
					readFile(fr.result);
            	}
              
            	fr.readAsText(file);
			}
		});

		function readFile(file){
			var parser, xmlDoc;
			parser = new DOMParser();
			xmlDoc = parser.parseFromString(file,"text/xml");
			var waypoints = xmlDoc.getElementsByTagName("wpt");

			for(let i = 0; i < waypoints.length; i++){
				var waypoint = waypoints[i];
				var name = waypoint.getElementsByTagName("name")[0].childNodes[0].nodeValue;
				var lat = waypoint.getAttribute("lat");
				var lon = waypoint.getAttribute("lon");
				const ll = new google.maps.LatLng(lat,lon);
				new google.maps.Marker({
				    position: ll,
				    map,
				    title: name,
				});
			}

			var tracks = xmlDoc.getElementsByTagName("trk");
			var trackSeg = [];
			for(let i = 0; i < tracks.length; i++){
				var track = tracks[i];
				var name = track.getElementsByTagName("name")[0].childNodes[0].nodeValue;
				var trackParts = track.getElementsByTagName("trkseg");

				for(let q = 0; q < trackParts.length; q++){
					var parts = trackParts[q].childNodes;
					for(let n = 0; n < parts.length; n++){
						var at = trackParts[q].childNodes[n].getAttribute("lat");
						var on = trackParts[q].childNodes[n].getAttribute("lon");
						trackSeg[trackSeg.length] = { lat: parseFloat(at), lng: parseFloat(on) };
					}
					const line = new google.maps.Polyline({
					    path: trackSeg,
					    geodesic: true,
					    strokeColor: "#FF0000",
					    strokeOpacity: 1.0,
					    strokeWeight: 2,
					});
					line.setMap(map);
				}
			}
		}




		function print(txt) {
			document.getElementById("temp").innerHTML = document.getElementById("temp").innerHTML+txt+"<br>";
			
	    }
		</script>

		<script>
		function createMap() {
			var mapProp = {
			  center:new google.maps.LatLng(51.508742,-0.120850),
			  zoom:5,
			};

			map = new google.maps.Map(document.getElementById("googleMap"),mapProp);
		}
		</script>

		<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyD5sDiro5hj0KdYEO2xweF19i5NmKRCM7k&callback=createMap"></script>

	</body>
</html>

